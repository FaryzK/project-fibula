FLOW INSPECTOR

The Flow Inspector is an alternate view of the workflow canvas page. Users toggle between the Canvas view and the Flow Inspector view using a toggle button in the toolbar. Both views live on the same page — the toggle simply switches what is rendered in the main area.

The Flow Inspector gives users a real-time view of what is happening inside each node. Documents can be seen flowing in and out of nodes as the workflow runs. For nodes that hold documents, users can see what is held and take action.


---

LAYOUT

The Flow Inspector has two main areas:

Left sidebar — a list of all nodes in the workflow, ordered topologically (following the direction of document flow). Each node row shows:
- The node name
- A colour accent matching the node's category (same colours as the canvas)
- Live count badges: number of documents currently Processing / Held / Failed at that node
- Clicking a node row selects it and opens its document panel on the right

Right panel — shows documents at the selected node. Tabs vary by node type:

For most nodes: Processing · Failed
For Extractor and Document Folder nodes: Processing · Held · Failed
For Reconciliation nodes: Held Documents · Failed

(Reconciliation nodes omit the Processing tab — documents transition through processing so briefly it is not meaningful to surface. The "Held" tab is renamed "Held Documents" for Reconciliation nodes to match the terminology used in the Reconciliation service.)

Top of the sidebar — an Orphaned section (always visible regardless of which node is selected). Clicking it opens the Orphaned documents panel in the right area.


---

PROCESSING TAB

Shows documents that are currently being processed at this node (status = processing, current_node_id = this node).

Each row shows:
- File name
- Time processing started

Documents appear at the bottom of the list as they arrive. Documents disappear automatically when they move on to the next node or become held or failed.

The list updates via polling every 2 seconds. No manual refresh required.

Empty state: "No documents currently processing."


---

HELD TAB (Extractor and Document Folder nodes)

Only shown for Extractor and Document Folder nodes.

Shows documents currently held at this node (status = held, current_node_id = this node).

Each row shows:
- File name
- Time held since
- For Extractor nodes: the hold reason (hold_all or missing mandatory fields)
- A Delete button to permanently remove the document execution

Documents appear at the bottom of the list as they become held. Documents disappear when they are released (sent to the next node) or deleted.

The list updates via polling every 2 seconds.

Empty state: "No documents held."


---

HELD DOCUMENTS TAB (Reconciliation nodes only)

Shown only for Reconciliation nodes, replacing the Processing and Held tabs.

Shows documents currently held at this reconciliation node (status = held, current_node_id = this node). These are documents that have arrived at the recon node and are waiting to be matched and reconciled. The brief processing state that occurs when a document first arrives is not surfaced — from the user's perspective, all documents in a recon node are in a held state.

Each row shows:
- File name
- Time held since
- A Delete button to permanently remove the document execution

The list updates via polling every 2 seconds.

Empty state: "No documents currently held."


---

FAILED TAB

Shows documents that failed at this node (looked up via node_execution_logs where node_id = this node and status = failed).

Each row shows:
- File name
- Time of failure
- Error message (truncated, expandable on click)
- A Delete button to permanently remove the document execution
- A Re-trigger button to re-run the document from the beginning of the workflow

The list updates via polling every 2 seconds.

Empty state: "No failed documents."


---

ORPHANED DOCUMENTS

Orphaned documents are document executions that were held at a node when that node was deleted. They are no longer attached to any active node and cannot continue through the workflow on their own.

The Orphaned panel shows all orphaned documents for the current workflow across all time.

Each row shows:
- File name
- The name of the node it was orphaned from (stored at time of deletion, since the node no longer exists)
- Time orphaned
- A checkbox for multi-select
- A Delete button per row

Bulk actions (appear when one or more rows are selected):
- Delete selected
- Re-trigger selected — opens the trigger selection modal (see Re-trigger flow below)

Empty state: "No orphaned documents."


---

NODE DELETION WARNING

When a user attempts to delete a node that has held documents, a warning modal appears before deletion proceeds.

The warning is triggered in two ways:
- Pressing Delete / Backspace on a selected node on the canvas
- Clicking the "Delete node" button in the NodePanel sidebar

The modal shows:
- How many documents are currently held at this node
- A note that processing documents will be allowed to complete naturally; if they later reach the deleted node they will fail and appear in the Failed tab of the orphaned section
- "If you proceed, all held documents will be moved to Orphaned Documents."

Actions in the modal:
- Cancel — dismiss and keep the node
- Proceed — delete the node and move all held documents to orphaned status

If the node has no held documents, deletion proceeds immediately without a warning (existing behaviour).

When held documents are orphaned due to node deletion:
- Their document_executions status is set to 'orphaned' and they appear in the Orphaned panel
- Their extractor_held_documents records (if any) are deleted so they no longer appear in the extractor's Held tab


---

EXTRACTOR NODE RECONFIGURATION WARNING

When a user changes the extractor assigned to an EXTRACTOR node (switching from extractor A to extractor B), the system checks whether the current extractor has any held documents.

If held documents exist, a warning modal appears before the change is saved:
- Shows how many held documents exist for the current extractor
- Notes that any documents held at this node will be moved to Orphaned Documents

Actions in the modal:
- Cancel — dismiss and keep the current extractor; no change is made
- Proceed — save the new extractor and move any held documents at this node (for the old extractor) to orphaned status

When held documents are orphaned due to extractor reconfiguration:
- Their document_executions status is set to 'orphaned' and they appear in the Orphaned panel
- Their extractor_held_documents records are deleted so they no longer appear in the extractor's Held tab

If the current extractor has no held documents, the change saves immediately without a warning.


---

RE-TRIGGER FLOW

Re-triggering sends a document back into the workflow from the beginning. The original file stored in Supabase Storage is reused — no re-upload is required.

If the workflow has exactly one trigger node (Manual Upload or Webhook), the re-trigger starts immediately with no additional prompt.

If the workflow has more than one trigger node, a modal appears for the user to choose which trigger(s) to send the document(s) to. The user can select multiple triggers (multi-select checkboxes). Each selected trigger will receive the document as if it had been uploaded there manually.

Re-trigger is available from:
- The Failed tab (per-document Re-trigger button)
- The Orphaned panel (per-document Re-trigger button, or bulk Re-trigger for selected documents)

When a document is re-triggered from the Orphaned panel, it is immediately removed from the Orphaned panel (its document_execution status is set to 'completed'). The new workflow run creates fresh document_execution records that track the document's new journey through the workflow.


---

DATA MODEL

document_executions gains a new status value: 'orphaned'

When a node is deleted and it has held documents, those document_executions are updated:
- status → 'orphaned'
- current_node_id → null
- A new column orphaned_node_name (TEXT) stores the name of the deleted node so it can be displayed in the Orphaned panel even though the node no longer exists

No changes are needed to node_execution_logs — the existing held/failed log entries remain and are used for the Held and Failed tab queries.


---

NODES THAT CAN HOLD DOCUMENTS

The Held tab is only shown for these node types:
- EXTRACTOR
- DOCUMENT_FOLDER
- RECONCILIATION

For all other node types the Held tab is hidden entirely.
