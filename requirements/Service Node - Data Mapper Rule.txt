There are 5 classes of nodes, and each class has a different usage. This document covers the service node - data mapper.

Trigger node
Example: manual upload

Pure execution node
Example: transform JSON, evaluate expression

Config node
Example: define system prompt once and reuse

Service node
Example: reconciliation dashboard showing matched documents, extractor node, data mapper

Webhook node (mainly used for sending events when something happens)

HTTP node (mainly used for exporting data)


---

DATA MAPPER NODE (Canvas)

The data mapper node enriches document metadata by looking up values in a reference table (data map set) and writing the matched values back into the document's extracted schema. It is useful for standardising data — for example, deriving a vendor code from a vendor name, or populating SKU codes from a product description lookup.

When a document with extracted metadata passes through the node, the configured rule runs, enriches the metadata, and outputs the document with updated field values.

Node Configuration
When placing a data mapper node on the canvas, the user selects a data map rule from a dropdown. The rule determines which extractor schema the node expects, what lookup to perform, and which fields to update.

The rule page shows a list of all canvas nodes using it, with navigation links to the relevant workflows.


---

DATA MAPPER SERVICE

The Data Mapper tab on the landing page has two sub-views: Data Map Sets and Data Map Rules.


---

DATA MAP SETS

A data map set is a reference table used for lookups. Examples: Vendor Master Data, SKU Conversion List, Currency Exchange Rates.

Creating a Data Map Set
Users can create a new set in three ways:
- CSV upload: system detects the first row as headers and creates records from the remaining rows
- JSON upload: same header detection and record creation
- Manual entry: user defines column headers one by one, then adds records manually

Each set has a name and an ordered list of column headers. Each record is a row of values keyed by those column headers.

Users can edit an existing set to update its name, headers, or records.


---

DATA MAP RULES

A data map rule defines how to enrich a document's extracted metadata using a data map set.

Creating a Rule
Each rule has:
- Rule name
- Extractor schema: which extractor's schema this rule targets. The schema determines the available header fields and table columns when configuring lookups and targets.

A rule consists of two parts: Lookup Criteria and Map Targets.

1. Lookup Criteria
Defines how to find the correct row in the data map set. Users add one or more lookup conditions (up to 7). Each condition:
- Selects a data map set
- Selects a set column to match against
- Selects a schema field (header field or table column) whose extracted value to compare
- Sets match type: Exact Match or Fuzzy Match (with a configurable similarity threshold, default 80%)

All lookup conditions are applied with AND logic — a candidate record must satisfy all conditions to be considered. When multiple records qualify, the one with the highest combined similarity score is selected.

Table column schema fields are referenced as "TableType.ColumnName" (e.g. "Invoice Items.Description"). Header fields are referenced by name directly (e.g. "VendorName").

2. Map Targets
Defines which fields to populate with values from the matched record. Each target:
- Sets target type: Header (update a header field) or Table Column (update a column in a table row)
- Selects a schema field to update
- Selects a data map set and set column to read the value from
- Sets mode: Map (write the set column value directly) or Calculation (evaluate a formula)

Calculation Mode
In calculation mode, the user writes a formula expression. The formula has access to two variables:
- `schema`: the current value of the target schema field in the document
- `mapset`: the value from the matched set column

Examples:
- `schema * mapset` — multiply the current schema value by the matched conversion rate
- `schema / mapset` — divide by the matched rate

This is useful for unit-of-measure conversion (e.g. dozens → units: multiply quantity by 12) or currency conversion (e.g. multiply total by exchange rate).

Header vs Table Target Behaviour
- Header targets: the lookup runs once using the document's header field values. The matched record's column value is written to the specified header field.
- Table column targets: the lookup runs once per row in the specified table. For each row, the lookup uses that row's column values (e.g. row Description, row UnitPrice) to find a matching record, then writes the target value back into that row. Rows with no matching record are left unchanged.

This enables row-by-row enrichment: for example, iterating over all invoice line items and populating a SKUCode column by matching Description and UnitPrice against a product master data set.

A single rule can have both header targets and table column targets. Each block runs independently using the same lookup criteria.

Node Usage List
The rule edit page shows all canvas nodes currently using this rule across all workflows. Clicking an entry navigates directly to that node on the canvas.
